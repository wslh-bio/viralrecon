Changes in component 'nf-core/artic/minion'
Changes in 'artic/minion/meta.yml':
--- modules/nf-core/artic/minion/meta.yml
+++ modules/nf-core/artic/minion/meta.yml
@@ -7,8 +7,8 @@
   - demultiplexed reads
 tools:
   - artic:
-      description: ARTIC pipeline - a bioinformatics pipeline for working with virus
-        sequencing data sequenced with nanopore
+      description: ARTIC pipeline - a bioinformatics pipeline for working with
+        virus sequencing data sequenced with nanopore
       homepage: https://artic.readthedocs.io/en/latest/
       documentation: https://artic.readthedocs.io/en/latest/
       tool_dev_url: https://github.com/artic-network/fieldbioinformatics
@@ -25,36 +25,35 @@
         description: FastQ file containing reads
         pattern: "*.{fastq.gz}"
         ontologies: []
-  - - meta2:
-        type: map
-        description: |
-          Groovy Map containing model information
-          e.g. [ id:'test', single_end:false ]
-    - model_dir:
-        type: directory
-        description: Path containing clair3 models, defaults to models packaged with
-          conda installation
-        pattern: "*"
-    - model:
-        type: string
-        description: |
-          The model to use for clair3, if not provided the pipeline will try to figure
-          it out the appropriate model from the read fastq
-  - - meta3:
-        type: map
-        description: |
-          Groovy Map containing scheme information
-          e.g. [ id:'test', single_end:false ]
-    - fasta:
-        type: file
-        description: Scheme reference fasta file
-        pattern: "*.{fasta}"
-        ontologies: []
-    - bed:
-        type: file
-        description: Scheme BED file
-        pattern: "*.{bed}"
-        ontologies: []
+  - fast5_dir:
+      type: directory
+      description: Directory containing raw FAST5 files
+      pattern: "*"
+  - sequencing_summary:
+      type: file
+      description: Sequencing summary file from Guppy
+      pattern: "*.txt"
+  - primer-schemes/${scheme}/V${scheme_version}/${scheme}.reference.fasta:
+      type: file
+      description: Reference FASTA file for ARTIC primer scheme
+      pattern: "*.fasta"
+  - primer-schemes/${scheme}/V${scheme_version}/${scheme}.scheme.bed:
+      type: file
+      description: BED file for ARTIC primer scheme
+      pattern: "*.bed"
+  - medaka_model_file:
+      type: file
+      description: File containing Medaka model to be used (if provided)
+      pattern: "*"
+  - medaka_model_string:
+      type: string
+      description: Medaka model name string (used if file not provided)
+  - scheme:
+      type: string
+      description: ARTIC primer scheme name
+  - scheme_version:
+      type: string
+      description: ARTIC primer scheme version
 output:
   results:
     - - meta:
@@ -153,7 +152,8 @@
             e.g. [ id:'test', single_end:false ]
       - ${prefix}.pass.vcf.gz:
           type: file
-          description: VCF file containing detected variants passing quality filter
+          description: VCF file containing detected variants passing quality
+            filter
           pattern: "*.{pass.vcf.gz}"
           ontologies: []
   tbi:

Changes in 'artic/minion/main.nf':
--- modules/nf-core/artic/minion/main.nf
+++ modules/nf-core/artic/minion/main.nf
@@ -4,13 +4,19 @@
 
     conda "${moduleDir}/environment.yml"
     container "${ workflow.containerEngine == 'singularity' && !task.ext.singularity_pull_docker_container ?
-        'https://community-cr-prod.seqera.io/docker/registry/v2/blobs/sha256/5a/5a747cc579edfc0cb2176b749afc02550ab5de678ae6a40d2cfadeba6c0de25d/data' :
-        'community.wave.seqera.io/library/artic:1.6.2--d4956cdc155b8612' }"
+        'https://depot.galaxyproject.org/singularity/artic:1.2.3--pyhdfd78af_0' :
+        'quay.io/biocontainers/artic:1.2.3--pyhdfd78af_0' }"
 
     input:
     tuple val(meta), path(fastq)
-    tuple val(meta2), path(model_dir), val(model)
-    tuple val(meta3), path(fasta), path(bed)
+    path  fast5_dir
+    path  sequencing_summary
+    path  ("primer-schemes/${scheme}/V${scheme_version}/${scheme}.reference.fasta")
+    path  ("primer-schemes/${scheme}/V${scheme_version}/${scheme}.scheme.bed")
+    path  medaka_model_file
+    val   medaka_model_string
+    val   scheme
+    val   scheme_version
 
     output:
     tuple val(meta), path("${prefix}.*")                              , emit: results
@@ -32,9 +38,16 @@
     script:
     def args = task.ext.args   ?: ''
     prefix   = task.ext.prefix ?: "${meta.id}"
-
-    def model_dir_cmd   = model_dir                ? "--model-dir ${model_dir}" : "--model-dir \$(which artic | sed 's/artic/models/')"
-    def hd5_plugin_path = task.ext.hd5_plugin_path ? "export HDF5_PLUGIN_PATH=${task.ext.hd5_plugin_path}" : "export HDF5_PLUGIN_PATH=/usr/local/lib/python3.6/site-packages/ont_fast5_api/vbz_plugin"
+    def version  = scheme_version.toString().toLowerCase().replaceAll('v','')
+    def fast5    = fast5_dir ? "--fast5-directory $fast5_dir"             : ""
+    def summary  = sequencing_summary ? "--sequencing-summary $sequencing_summary" : ""
+    def model    = ""
+    if (args.tokenize().contains('--medaka')) {
+        fast5   = ""
+        summary = ""
+        model   = medaka_model_file ? "--medaka-model ./$medaka_model_file" : "--medaka-model $medaka_model_string"
+    }
+    def hd5_plugin_path = task.ext.hd5_plugin_path ? "export HDF5_PLUGIN_PATH=" + task.ext.hd5_plugin_path : "export HDF5_PLUGIN_PATH=/usr/local/lib/python3.6/site-packages/ont_fast5_api/vbz_plugin"
     """
     ${hd5_plugin_path}
 
@@ -43,10 +56,12 @@
         ${args} \\
         --threads ${task.cpus} \\
         --read-file ${fastq} \\
-        --bed ${bed} \\
-        --ref ${fasta} \\
-        ${model_dir_cmd} \\
-        --model ${model} \\
+        --scheme-directory ./primer-schemes \\
+        --scheme-version ${version} \\
+        ${model} \\
+        ${fast5} \\
+        ${summary} \\
+        ${scheme} \\
         ${prefix}
 
     cat <<-END_VERSIONS > versions.yml

Changes in 'artic/minion/environment.yml':
--- modules/nf-core/artic/minion/environment.yml
+++ modules/nf-core/artic/minion/environment.yml
@@ -4,5 +4,5 @@
   - conda-forge
   - bioconda
 dependencies:
-  - bioconda::artic=1.6.2
-  - bioconda::htslib=1.17 # can't be updated due to dependency issues
+  - bioconda::artic=1.2.3
+  - bioconda::htslib=1.15.1 # can't be updated due to dependency issues

'modules/nf-core/artic/minion/tests/main.nf.test' is unchanged
'modules/nf-core/artic/minion/tests/main.nf.test.snap' is unchanged
************************************************************
